# 数字图像处理

## 一、 简介

水

## 二、 视觉感知要素

### 2.1 视觉基本要素

人的视觉由眼睛中的两种感觉细胞形成：锥状体和杆状体（视锥、视杆细胞）。前者对色彩敏感，其视觉称为白昼视觉或亮光视觉；后者给出图像轮廓，没有色彩感觉，低照明度下更敏感，称为夜视觉或暗视觉。

视觉系统能适应的光强度级别很宽，这是通过不断改变视觉灵敏度来实现的。低照明级别下杆状体其主要作用，高照明级别下锥状体其主要作用。

韦伯比：度量人眼特定的适应级别对亮度变化的辨别力。$\frac{\Delta I_c}{I}$

在低照明级别，亮度辨别力差；在高照明级别，亮度辨别力好。

视觉系统倾向于不同强度区域边界的欠调和过调现象（颜色组合产生的凹凸感），以及同时对比现象（颜色组成产生的亮度不同的感受）说明感觉亮度不是简单的强度函数。

### 2.2 光和电磁波

波长与波速的关系：$\lambda = c/v$

波速与能量的关系：$E=h*v$

描绘彩色光源质量的基本量：

- 发光强度：光源流出的能量
- 光通量：观察者从光源感受的能量（如红外光有实际能量，但光通量为0）
- 亮度：主观描述

### 2.3 图像的感知和获取

用$i(x,y)$表示入射到场景的光源总和，即入射分量，$r(x,y)$为场景中物体反射光的总量，即反射分量。二者的乘积$f(x,y)$形成了图像函数。其中反射分量范围为[0,1]，0为全吸收，1为全反射。

### 2.4 图像取样与量化

图像数字化=取样+量化

数字化图像用矩阵表示，每个像素包含两个信息：位置和颜色数值。分辨率为最大像素数。

### 2.5 像素间的基本关系

相邻像素：上下左右的像素称为中间像素`p`的四邻域，记为$N_4(p)$，四个对角相邻像素记为$N_D(p)$，二者合并称为中间像素`p`的八邻域，记为$N_8(p)$。

---------

## 三、 灰度变换与空间滤波

图像增强是图像处理中最具吸引力的领域，目的是提高图像在特定应用领域的视觉质量，没有通用的理论和方法，主观评价为主。图像增强共有两大类算法：空间域和频率域。

### 3.1 背景

空间域图像增强的是直接对图像的像素进行操作，基本关系式可表示如下：
$$
g(x,y)=T(f(x,y))
$$
其中$f(x,y)$是输入图像，即原图像，$g(x,y)$为处理后的图像。$T$为作用在$f$上的一个算子，定义域是$(x,y)$的某个邻域。这个邻域可以是一个点，这时称作灰度变换gray level transformation：$s=T(r)$。更大邻域的处理类似于卷积神经网络的卷积过程，用网格去各个位置对应计算。

### 3.2 基本灰度变换

用于图像增强的某些基本灰度函数：线形、对数、幂次等。

- 图像翻转变换：$s=L-1-r$，其中$L-1$为像素最亮时的大小。

- 对数变换：$s=c\log(1+r)$，其中c是常数，$r\geq 0$，适合大范围的数据压缩。任何具有对数函数曲线形状的变换都可以完成灰度的压缩和扩展功能。

- 幂次变换：$s=cr^\gamma$，其中两个参数均为正的常数。当幂指数变化时，得到一系列不同的曲线，对应于不同效果的变换。 

伽玛校正：大量的图像设备如捕捉卡、打印机、数码相机以及显示装置的响应（输出）就对应一个幂函数。纠正这个幂次响应的处理称为伽玛校正（gamma correction）。伽马校正校正对在计算机屏幕上精确显示图像很重要，还可以用于调整图像对比度。γ小于1则提高对比度，反之则降低。

- 分段线性变换：函数表述即为分段线性函数。
- 灰度切割（灰度级分层）：总体是线性函数，但在某一区间内为函数值为常数。在图像中提高特定灰度的亮度。

- 位图切割（比特平面分层） ：8位灰度图象可以按照第几位分割成8个位面。高位表示了重要的信息，低位给出了不同程度的细节。

### 3.3 直方图histogram处理

对于灰度级别为[0,L-1]的图像，直方图是离散函数$h(r_k)=n_k$。其中$r_k$表示第k级的灰度，$n_k$表示灰度为$r_k$的像素点的个数。如果用图像的像素总数n除以每个值，就得到了归一化后的直方图：
$$
P(r_k)=\frac{n_k}{n}
$$
归一化直方图满足$0\leq P(r_k)\leq 1(k=0,1,...,L-1)$且$\sum_kP(r_k)=1$。

#### 3.3.1 直方图的均衡化

直方图是图像处理领域中的一个重要工具，也可以用于图像增强。一般情况下，图像的直方图成均匀分布态势，则图像的对比度较高且有比较丰富的灰度色调。所以可以找一种变换，使得变换后的图像尽可能有均匀分布的直方图。需要满足的条件：

- 变换函数单调递增
- 定义域和值域相同，都为[0,L-1]

直方图均衡化步骤：

1. 计算概率分布：$p_r(r_k)=\frac{n_k}{n},k=0,1,...,L-1$
2. 计算累计分布函数：$P(r_k)=\sum^k_{j=0}p_r(r_j)=\sum^k_{j=0}\frac{n_j}{n}$

3. 变换函数：$s_k=T(r_k)=(L-1)*\sum^k_{j=0}\frac{n_j}{n}$

4. 将得到的$s_k$四舍五入成标准灰度级别。相同的$\lceil s_k\rceil$需要合并。

这是一种直方图均衡化方法的方法。直方图均衡化方法用于图像增强有一个最大的特点：自动化。有强大的适应性强的功能。

直方图均衡化并不适用于所有的图像。可能出现灰度跳变gray level jump：如果某一灰度在原始图像中所占比例较大，则结果图像中相邻的两个灰度之间会有较大的差异，显示效果可能较差。原因：对离散情形，我们很难得到类似连续情形的理论结果。 

#### 3.3.2 直方图匹配

即使得输出图像有指定的直方图。两幅图像比对前，通常要使其直方图形式一致，比如同一场景在不同的光照条件下数字化为两幅图像，在比较前，可用这种变换。

1. 计算原图的直方图$s_k=(L-1)\sum^k_{j=0}\frac{n_j}{n}$
2. 给出期望输出图像的直方图$p_z(z)$，令$v_k=G(z_k)=(L-1)\sum^k_{i=0}p_z(z_i)=s_k$

3. 得到离散情形的变换公式$z_k=G^{-1}(T(r_k)),z_k=G^{-1}(s_k)$

其中G为均衡化操作。

简单来说，就是将输入直方图和输出直方图都进行均衡化操作，然后令二者相等。输入要经过两次变化：自身均衡化、能将输出直方图均衡化的逆操作

#### 3.3.3 局部增强技术

即在局部应用直方图匹配和均匀化。略。

#### 3.3.4 在图像增强中使用直方图统计

设$p(r_i)=\frac{n_i}{n}$，则r的第n阶中心矩定义为：
$$
\mu_n{r}=\sum^{L-1}_{i=0}(r_i-m)^np(r_i)
$$
其中，m为r的平均值：
$$
m=\sum^{L-1}_{i=0}r_ip(r_i)
$$
当中心矩的n取2时则为方差，记为$\sigma_2$。

在实际的二维采样中：
$$
m=\frac{1}{MN}\sum^{M-1}_{x=0}\sum^{N-1}_{y=0}f(x,y)
$$

$$
\sigma_2=\sum^{M-1}_{x=0}\sum^{N-1}_{y=0}[f(x,y)-m]^2
$$

### 3.4 空间滤波基础

基础运算：加减乘除与或非

#### 3.4.1 图像减法处理

主要作用是增强两幅图之间的差异。图像相减后进行均衡化处理。

#### 3.4.2 图像平均处理

设$f(x,y)$为原始图像，$\eta(x,y)$为随机噪音。各个坐标点上的噪音不相关，且均值为0。带噪音的图像为$g(x,y)=f(x,y)+\eta(x,y)$。对K幅带噪音的图像取平均：
$$
\overline g(x,y)=\frac{1}{K}\sum^K_{k=1}g_k(x,y)
$$


则有期望值：
$$
E(\overline g(x,y))=f(x,y)
$$
均方差：
$$
\sigma^2_{\overline g(x,y)}=\frac{1}{K}\sigma^2_{\eta(x,y)}
$$
即K越大，平均图像的均方差越小，故噪音越小。这是平均处理方法去噪的理论背景。

#### 3.4.3 空间滤波机理

滤波的概念来自傅里叶变换。空间滤波指的是直接对图像像素进行处理的操作。

空间域线性滤波的基本公式：
$$
g(x,y)=\sum^a_{s=-a}\sum^b_{t=-b}w(s,t)f(x+s,y+t)
$$
其中$w(s,t)$为滤波器的系数，又叫掩模mask系数。$a$和$b$给出了滤波器大小。常常令二者相等且为奇整数。

#### 3.4.4 空间相关与空间卷积

相关correlation操作：$w(x,y)\circ f(x,y)=\sum^a_{s=-a}\sum^b_{t=-b}w(s,t)f(x+s,y+t)$

卷积convolution操作：$w(x,y)*f(x,y)=\sum^a_{s=-a}\sum^b_{t=-b}w(s,t)f(x-s,y-t)$

卷积是将核旋转了180度（以卷积核中间元素位置为中心的同平面旋转）。

### 3.5 平滑空间滤波器

平滑的主要作用是去除细小的细节（噪声）提取大的目标，从而得到物体的一个大致描述。平滑滤波器分线性和非线性两种。

#### 3.5.1 线性滤波器

常用的的光滑滤波器：

- 3*3，各个元素均为1/9
- 3*3，四个角为1/16，四个边为1/8，中心为1/4

一般公式：
$$
g(x,y)=\frac{\sum^a_{s=-a}\sum^b_{t=-b}w(s,t)f(x+s,y+t)}{\sum^a_{s=-a}\sum^b_{t=-b}w(s,t)}
$$

#### 3.5.2 统计排序（非线性）滤波器

排序统计滤波器是一种非线性的、非卷积滤波器。排序统计滤波器在滤波器包围的像素范围内排序，然后由统计排序结果决定的值代替中心像素的值。按排序输出的位置分，可分为：中值滤波、最大值滤波、最小值滤波。（类似于卷积神经网络的池化？）

中值滤波器取中位数。类似均值线性滤波器用于去噪，但中值滤波器在衰减噪声的同时不使边界模糊。为了节省时间，可以在整个滤波器大小的像素点中选取特定位置的几个计算。这种滤波器称为模板。

中值滤波器比均值滤波器更适合去除加性椒盐噪声（纯白或纯黑的噪声点）。

### 3.6 空间锐化滤波器

 锐化的目的和平滑相反，是为了突出图像中的细节或者增强被模糊了的细节。对图像像素邻域作线性平均（求和、积分），可以得到光滑图像的效果。那么可以想象如果用“求差、微分”的方法，应该得到相反的结果。

#### 3.6.1  一维情况

对于离散情况，
$$
\frac{df}{dx}=f(x+1)-f(x)
$$

$$
\frac{d^2f}{dx^2}=f(x+1)+f(x-1)-2f(x)
$$



- 一阶微分产生较“宽”的边界，二阶微分产生较“细”的边界；

- 二阶微分处理对细节有较强的响应，如细线和孤立点；

- 一阶微分对阶梯状的灰度变化有较强的响应；

- 二阶微分在处理阶梯状灰度变化时产生双响应

- 如果灰度的变化相似，二阶微分对线的反应比对阶梯强，对点的反应比对线强。

#### 3.6.2 拉普拉斯算子

对连续函数情形，最简单且各向同性的二阶微分算子是拉普拉斯（Laplacian）算子
$$
\nabla^2f=\frac{d^2f}{dx^2}+\frac{d^2f}{dy^2}
$$
离散情况：
$$
\nabla^2f=f(x+1,y)+f(x-1,y)+f(x,y+1)+f(x,y-1)-4f(x,y)
$$
可以直接用滤波器的形式表示。用拉普拉斯算子作用后，产生的图像将是在暗背景上的一些灰色边线和一些突变点。若将原始图像叠加到拉普拉斯变换后的图像，既可以保护拉普拉斯锐化处理的效果，同时又能复原背景信息。

拉普拉斯图像增强的基本方法为： 
$$
g(x,y)=f(x,y)\pm\nabla^2f
$$
正负号取决于拉普拉斯滤波中心系数的正负。

#### 3.6.3 非锐化掩模和高提升滤波Unsharp Masking and high-boost filtering

非锐化掩模一般公式： 
$$
f_s(x,y)=f(x,y)-\overline f(x,y)
$$
公式的物理意义就是把原图的一个模糊过的图像从原图中减去，从而得到一个相对清晰的图像。更普遍形式就是所谓的高提升滤波处理，一般表达式为：
$$
f_{hb}(x,y)=Af(x,y)-\overline f(x,y)
$$
其中$A\geq 1$，目的是提升原图的亮度。等价于：
$$
f_{hb}(x,y)=(A-1)f(x,y)+f_s(x,y)
$$
前一部分“调整”了原图的灰度，后一部分是锐化过的图像。

基于拉普拉斯算子的高提升滤波：
$$
f_{x,y}(x,y)=Af(x,y)\pm\nabla^2f
$$
A过大则锐化效果会减弱。

### 3.6 基于一阶微分的图像增强：梯度

一阶微分在灰度的跳跃性间断处（边界处）有较强的响应，所以在一些情况下也可以用于图像增强。定义二维函数的梯度：
$$
\nabla\bold f=[G_x,G_y]=[\frac{df}{dx},\frac{df}{dy}]
$$
定义梯度的L2模：
$$
\nabla f=[G_x^2,G_y^2]^{1/2}=[(\frac{df}{dx})^2,(\frac{df}{dy})^2]^{1/2}
$$
L2模具有各向同性的性质，但计算不方便。为了克服计算复杂的困难，在某些情况下，用L1模可以减少计算量，并且不影响结果：
$$
\nabla f=|G_x|+|G_y|
$$
通常在不引起混淆的情况下，把梯度的模称为梯度。

如何计算离散图像数据的梯度？一种算法是2×2的掩模上的交叉差分（Robert交叉梯度算子）:
$$
G_x=(z_9-z_5),G_y=(z_8-z_6)
$$
或者在3*3的掩模上计算（Sobel算子）:
$$
\nabla f=(z_7+2z_8+z_9)-(z1+2z_2+z3)+(z_3+2z_6+z_9)-(z_1+2z_4+z_7)
$$
 同样都能写成滤波器形式。

### 3.7 混合空间增强法（略）

结合多种技术，进行混合强化。

------

## 四、 频率与滤波

**本节的傅里叶变换的离散情形，除以MN有时是在正变换，有时是在反变换，有时是正变换反变换同除MN的平方根，需要具体情况具体分析。一般来说，做计算题时在反变换除，讨论数字图像处理时在正变换除**

### 4.1 傅里叶变换

任何周期函数都可以表示为(分解成)不同频率的正弦波和/或余弦波的加权和，从而提供了一种具有物理意义的函数表达式，即傅里叶级数。

设f(t)是以T为周期的函数，满足一定的条件，如绝对可积，则有：
$$
f(t)=\sum_{n=-\infin}^\infin c(n)e^{j\frac{2\pi n}{T}t}
$$
其中，
$$
c(n)=\frac{1}{T}\int_{-T/2}^{T/2}f(t)e^{-j\frac{2\pi n}{T}t}dt,n=0,\pm 1,\pm2...
$$
对于曲线下面积有限的非周期函数，也可以用正弦和/或余弦乘以加权函数的积分表示：
$$
f(t)=\int_{-\infin}^{+\infin}F(u)e^{j2\pi ut}du
$$
傅氏级数中基底的物理意义非常明确, 每一个基函数都是一个单频谐波，而相应的系数(频谱)表明了原函数对这种频率成份贡献的大小(原函数在这个谐波上的投影),，或者说原函数中某种频率成分的多少。傅里叶系数的计算：
$$
a_k=\frac{1}{T}\int_o^Tf(x)\cdot e^{-jk(\frac{2\pi}{T})x}dx
$$

### 4.2 基本概念

#### 4.2.1 冲激

$$
\delta(t)=
\left\{
\begin{array}{}
\infin,t=0\\
0,t\neq0
\end{array}
\right.
$$

且有：
$$
\int_{-\infin}^\infin\delta(t)dt=1
$$
冲激的取样特性：
$$
\int^\infin_{-\infin}f(t)\delta(t)dt=f(0)
$$

$$
\int^\infin_{-\infin}f(t)\delta(t-t_0)dt=f(t_0)
$$

离散情况类似：
$$
\sum_{t=-\infin}^\infin f(t)\delta(t-t_0)=f(t_0)
$$
冲激串：
$$
s_{\Delta T}(t)=\sum^\infin_{t=-\infin}\delta(t-n\Delta T)
$$

#### 4.2.2 复数

复数表示为：C=R+Ij，其中R和I为实数，分别称为实部和虚部。j为虚数单位。

欧拉公式：
$$
e^{j\theta}=\cos\theta+j\sin\theta
$$
复数的极坐标表示：
$$
C=|C|(\cos\theta+j\sin\theta)=|C|e^{j\theta},|C|=\sqrt{R^2+I^2}
$$
引入复数的概念后，**一维连续傅里叶变换及反变换**可以表示为：
$$
F(u)=\int_{-\infin}^{+\infin}f(t)e^{-j2\pi ut}dt=\int_{-\infin}^{+\infin}f(t)[\cos(2\pi ut)-j\sin(2\pi ut)]dt
$$

$$
f(t)=\int_{-\infin}^{+\infin}F(u)e^{j2\pi ut}du
$$

幅值（傅里叶谱/频谱）：
$$
|F(u)|=[R^2(u)+I^2(u)]^{1/2}
$$

##### 矩形函数的傅里叶变换

$$
f(t)=\left\{
\begin{array}{}
A,-W/2\leq t\leq W/2\\
0,Others
\end{array}
\right.
$$

则：
$$
F(u)=AW\cdot sinc(uW)
$$
其中，$sinc(m)=\frac{\sin(\pi m)}{\pi m}$

##### 冲激的傅里叶变换

$$
F(u)=\int^\infin_{-\infin}\delta(t-t_0)e^{-j2\pi ut}dt=e^{-j2\pi ut_0}=\cos(2\pi ut_0)-j\sin(2\pi ut_0)
$$

$t_0=0$时，F(u)=0

##### 冲激串的傅里叶变换

周期为$\Delta T$的冲激串的傅里叶变换是周期为$1/\Delta T$的冲激串

#### 4.2.3 卷积

$$
f(t)*g(t)\int^\infin_{-\infin}f(\tau)g(t-\tau)d\tau
$$

这里的星号表示卷积处理而不是乘法。

卷积定理（双箭头表示傅里叶变换和反变换）：频域/时域的两个函数卷积相当于另一个域作乘法
$$
f(t)*g(t)\Leftrightarrow F(\mu)G(\mu)\\
f(t)g(t)\Leftrightarrow F(\mu)*G(\mu)
$$

### 4.3 取样

#### 4.3.1 基于冲激串的取样

$$
\tilde {f(t)}=f(t)s_{\Delta T}(t)=\sum_{n=-\infin}^{+\infin}f(t)\delta(t-n\Delta T)=f(n\Delta T)
$$

#### 4.3.2 取样函数的傅里叶变换

用$\zeta$表示傅里叶变换：
$$
\tilde F(\mu)=\zeta\{\tilde f(t)\}=\zeta\{f(t)s_{\Delta T}(t)\}=F(\mu)*S(\mu)=\frac{1}{\Delta T}\sum^\infin_{n=-\infin}F(\mu-\frac{n}{\Delta T})
$$
由此可以看出，时域的取样虽然不连续，但其傅里叶变换是连续的，由原本时域函数的傅里叶变换的几个副本组成。

在二维空间中，冲激函数为：
$$
\delta(x,y)=
\left\{
\begin{array}{}
\infin,x=y=0\\
0,Others
\end{array}
\right.
$$


一些结论：

- $\sum_{x=0}^{M-1}\sum_{y=0}^{N-1}s(x,y)A\delta(x,y)=As(0,0)$

- $F(u,v)=\frac{1}{MN}\sum_{x=0}^{M-1}\sum_{y=0}^{N-1}\delta(x,y)e^{-j2\pi(ux/M+vy/N)}=\frac{1}{MN}$

- $\delta(x,y)*h(x,y)=\frac{1}{MN}\sum_{m=0}^{M-1}\sum_{n=0}^{N-1}\delta(m,n)h(x-m,y-n)=\frac{1}{MN}h(x,y)$

#### 4.3.3 取样定理

带限函数：对于以原点为中心的有限区间$[-\mu_\max,\mu_\max]$（称为带宽）之外的频率值，傅里叶函数变换为0。

取样定理：如果以超过函数最高频率的两倍的取样率来获得样本，连续带限函数能完全由其样本恢复：$\frac{1}{\Delta T}>2\mu_\max$

假设H为以略高于上述取样率的函数的傅里叶变换（低通滤波器），即：
$$
H(\mu)=\left\{
\begin{array}{}
\Delta T,-\mu_\max\leq\mu\leq\mu_\max\\
0,Others
\end{array}
\right.
$$
重建原函数：$F(\mu)=H(\mu)\tilde F(\mu)$，$f(t)=\int_{-\infin}^\infin F(\mu)e^{j2\pi\mu t}d\mu$

#### 4.3.4 混淆

如果以低于最高频率的两倍的采样率去的样本，即欠采样，就会产生混淆。现实中混淆不可避免，可以通过平滑原函数减少高频来降低混淆的影响。

### 4.4 单变量离散傅里叶变换DFT

$$
F(u)=\sum_{x=0}^{M-1}f(x)e^{-j2\pi ux/M},x=0,1,..,M-1\\
f(x)=\frac{1}{M}\sum^{M-1}_{x=0}F(u)e^{j2\pi ux/M},x=0,1,...,M-1
$$

离散傅里叶变换和它对应的反变换总是存在的，不必特地关心。傅里叶正变换和反变换的周期为M，则存在k，满足：
$$
F(\mu)=F(\mu+kM)\\
f(\mu)=f(x+kM)
$$

### 4.5 二维函数的扩展

#### 4.5.1 连续

$$
F(\mu,v)=\int_{-\infin}^\infin\int_{-\infin}^\infin f(t,z)e^{-j2\pi(\mu t+vz)}dtdz\\
f(t,z)=\int_{-\infin}^\infin\int_{-\infin}^\infin F(\mu,v)e^{j2\pi(\mu t+vz)}d\mu dv\\
$$

基于二维冲激串的二维取样：
$$
\tilde f(t,z)=f(t,z)s_{\Delta T\Delta Z}(t,z)=\sum_{m=-\infin}^\infin\sum_{m=-\infin}^\infin f(t,z)\delta(t-n_1\Delta T,z-n_2\Delta Z)
$$
二维采样定理：如果一个二维带限连续函数在u和v两个方向上由以大于该函数最高频率两倍的取样率取样获得的样本表示，则没有信息丢失（无误地恢复）。即$\frac{1}{\Delta T}>2\mu_\max$以及$\frac{1}{\Delta Z}>2v_\max$

#### 4.5.2 离散

$$
F(\mu,v)=\sum_{x=0}^{M-1}\sum_{y=0}^{N-1} f(x,y)e^{-j2\pi(\mu x/M+vy/N)}\\
f(x,y)=\frac{1}{MN}\sum_{x=0}^{M-1}\sum_{y=0}^{N-1} F(\mu,v)e^{j2\pi(\mu x/M+vy/N)}
$$

易得：
$$
F(0,0)=\frac{1}{MN}\sum_{x=0}^{M-1}\sum_{y=0}^{N-1} f(x,y)
$$
是图像的平均灰度。因为原点处两个方向的频率都为0。这个量被称为频谱的直流分量DC。傅里叶变换每个频谱分量都要涉及到图像空间中的每个象素,，所以一般来说，频谱信息中很难看出空间的信息。由于频率反映的是空间强度的变化率, 如低频对应着图像变化慢的部分, 高频对应着图像变化快的部分，所以在某种意义上两者之间仍然有不可分割的联系, 尽管这些联系是“总体”的。

#### 4.5.3 二维离散变化的性质

空间频率间隔关系：
$$
\Delta u=\frac{1}{M\Delta x},\Delta v=\frac{1}{N\Delta y}
$$
平移（不影响幅度）：
$$
f(x,y)e^{j2\pi(u_0x/M+v_0y/N)}\Leftrightarrow F(u-u_0,v-v_0)\\
f(x-x_0,y-y_0)\Leftrightarrow F(u,v)e^{-j2\pi(ux_0/M+vy_0)/N)}
$$
同角度旋转（不影响幅度）：
$$
f(r,\theta+\theta_0)\Leftrightarrow F(\omega,\phi+\phi_0)
$$
周期性：
$$
F(\mu,v)=F(\mu+k_1M,v)=F(\mu,v+k_2N)=F(\mu+k_1M,v+k_2N)\\
f(x,y)=f(x+k_1M,y)=f(x,y+k_2N)=f(x+k_1M,y+k_2N)
$$
为了把变换后的中心移到图像的中心(M/2, N/2)，通常在变换之前都要在函数上乘以$(-1)^{x+y}$。这是由于傅里叶变换的平移性质得到的。

一维下：
$$
f(x)(-1)^x\Leftrightarrow F(u-M/2)\\
f(x-M/2)\Leftrightarrow F(u)(-1)^u
$$
二维：
$$
f(x,y)(-1)^{x+y}\Leftrightarrow F(u-M/2,v-N/2)
$$
实函数的傅里叶变换是共轭对称的：
$$
F^*(u,v)=F(-u,-v)
$$
虚函数的傅里叶变换是反共轭对称的：
$$
F^*(-u,-v)=-F(u,v)
$$

### 4.6 傅里叶谱和相角

谱的概念：傅里叶变换后的函数在复数域内，即：
$$
F(u,v)=R(u,v)+jI(u,v)=|F(u,v)|e^{j\phi(u,v)}
$$
其中傅里叶变换的幅度（又称谱）为：
$$
|F(u,v)|=\sqrt{R^2(u,v)+I^2(u,v)}
$$
谱可以表示原函数对某一频谱分量的贡献。

相角或相位谱为：
$$
\phi(u,v)=\arctan[\frac{I(u,v)}{R(u,v)}]
$$
相位谱表示原函数中某一频谱的分量的起始位置。

还有一个重要的量是功率谱（能量谱、谱密度）：
$$
P(u,v)=|F(u,v)|^2=R^2(u,v)+I^2(u,v)
$$
有基本性质：

- $|F(\mu,v)|=|F(-\mu,-v)|$
- $\phi(u,v)=-\phi(-u,-v)$

- $F(0,0)=MN|\tilde f(x,y)|$

### 4.7 频域滤波器

至此，将图像采样、变换、还原的步骤为：

1. $(-1)^{(x+y)}$乘以原图像，做频谱中心化处理
2. 对1得到的$f(x,y)$进行DFT，得到$F(u,v)$

3. 滤波器处理$G(u,v)=H(u,v)F(u,v)$

4. 将$G(u,v)$进行反DFT处理
5. 取第4步得到的实部
6. 用$(-1)^{(x+y)}$乘以第5步的结果

陷波滤波器notch filter：使得处理后的图像的平均值变为0，从而降低整体的灰度：
$$
H(u,v)=\left\{
\begin{array}{}
0,(u,v)=(M/2,N/2)\\
1,Others
\end{array}
\right.
$$
空间域的滤波器和频率域的滤波器组成了一组傅里叶变换对。也就是说，给出在频率域的滤波器，通过傅里叶反变换就可以得到在空间域相应的滤波器，反之亦然

卷积定理可以建立关系：
$$
f(x,y)*h(x,y)\sum^{M-1}_{m=0}\sum^{N-1}_{n=0}f(m,n)h(x-m,y-n)
$$
空间域滤波的本质就是用选好的掩模经过一定的处理与给定的图像做卷积。

在频率域选择滤波器更为直观、物理意义比较明确；在空间域用较小的模板进行滤波计算则比较经济。如果两个滤波器的大小一样则在频率域进行滤波计算比较方便。这提供了一个思路：在频率域找到一个有意义的滤波器，然后作傅里叶反变换，并以此为依据尽可能在空间域建造尽可能小的滤波模板。

比如频率域的高斯滤波器$H(u)=Ae^{-u^2/2\sigma^2}$，对应的空间滤波器为$h(x)=\sqrt{2\pi}\sigma Ae^{-2\pi^2\sigma^2x^2}$。高斯函数有两个重要性质：

- 其本身和傅里叶变换都是实高斯函数
- 傅里叶变换和反变换有反比特征，即H(u)较宽，则h(x)较窄。这是$\sigma$决定的。当接近于无限时，H(u)接近于常量而h(x)趋近于冲激函数

#### 4.7.1 平滑滤波器

##### 理想低通滤波器ILPF

$$
H(u,v)=\left\{
\begin{array}{}
1,D(u,v)\leq D_0\\
0,D(u,v)>D_0
\end{array}
\right.
$$

其中，
$$
D(u,v)=\sqrt{(u-M/2)^2+(v-N/2)^2}
$$
$D_0$被称为截止频率。对低通滤波器来说，截止频率位置的设定是根据计算低通滤波器通过的频率成分所包含的功率以及它们在图象总功率值$P_T$中所占的比例决定的。
$$
P_T=\sum_{u=0}^{M-1}\sum_{v=0}^{N-1}P(u,v)=\sum_{u=0}^{M-1}\sum_{v=0}^{N-1}|F(u,v)|^2
$$
需要注意的是，理想的低通滤波器无法用硬件实现；截止频率太低会有滤波模糊和振铃现象

##### 巴特沃斯低通滤波器BLPF

n阶巴特沃斯低通滤波器的传递函数定义为：
$$
H(u,v)=\frac{1}{1+[D(u,v)/D_0]^{2n}}
$$
其中，
$$
D(u,v)=\sqrt{(u-M/2)^2+(v-N/2)^2}
$$
在通带和被滤除的频率之间没有明显的截断。定义的截止频率$D_0$使得该位置频率的幅度降到最大值的一半。

一阶BLPF没有振铃，二阶振铃很小。随着阶数增高振铃逐渐增大。通常来说，二阶BLPF是在有效的低通滤波和可接受的振铃特性之间的转折。

##### 高斯低通滤波器GLPF

$H(u,v)=e^{-D^2(u,v)/2D_0^2}$

没有振铃的滤波器。在同样的截止频率下，GLPF不如二阶BLPF效果好。

#### 4.7.2 锐化滤波器

和低筒滤波器相反的操作即可得到高通滤波器：$H_{hp}(u,v)=1-H_{lp}(u,v)$

##### 理想高通滤波器IHPF

$$
H(u,v)=\left\{
\begin{array}{}
0,D(u,v)\leq D_0\\
1,D(u,v)>D_0
\end{array}
\right.
$$

##### 巴特沃斯高通滤波器BHPF

$$
H(u,v)=\frac{1}{1+[D_0/D(u,v)]^{2n}}
$$

##### 高斯高通滤波器GHPF

$H(u,v)=1-e^{-D^2(u,v)/2D_0^2}$

##### 频率域的拉普拉斯算子

傅里叶变换的微分性质：
$$
\frac{d^nf(x)}{dx^n}\Leftrightarrow(ju)^nF(u)\\
\frac{\part^2f(x,y)}{\part x^2}+\frac{\part^2f(x,y)}{\part y^2}\Leftrightarrow-(u^2+v^2)F(u,v)
$$
因此拉普拉斯算子可以表示为以下频域滤波器：
$$
H(u,v)=-(u^2+v^2)
$$
原图中心化后，写成：
$$
H(u,v)=-((u-M/2)^2+(v-N/2)^2)
$$

##### 高提升滤波器

$H_{hb}(u,v)=(A-1)+H_{hp}(u,v),A\geq1$。其中$A-1$的常数部分表示原图有多少被保留，后面的高通滤波器用于提高其中的高频成分。

##### 高频加强滤波

$H_{hfe}(u,v)=a+bH_{hp}(u,v),a\geq0,b>a$，当b>1则高频得到加强。a一般取0.25~0.5，b取1.5~2.0。

#### 4.7.2 同态滤波器

图像成像模型：照射分量\*反射分量：$f(x,y)=i(x,y)r*(x,y)$。同态滤波器的作用是控制图象亮度的变化范围，增强对比度

算法步骤：

1. $\ln f(x,y)=\ln i(x,y)+\ln r(x,y)$
2. $F(u,v)=I(u,v)+R(u,v)$
3. $H(u,v)F(u,v)=H(u,v)I(u,v)+H(u,v)R(u,v)$
4. $h_f(x,y)=h_i(x,y)+h_r(x,y)$
5. $g(x,y)=\exp|h_f(x,y)|=exp|h_i(x,y)|\cdot\exp|h_r(x,y)|$

图象的照射分量通常以空间域的慢变化为特征，而反射分量往往引起突变。因此图象频谱函数的低频和高频部分分别对应照射分量和反射分量。图象的增强通常是抑制光照，增强细节特征，因此可以选择如下的同态滤波器：
$$
H(u,v)=(\gamma_H-\gamma_L)[1-e^{-c(D^2(u,v)/D_0^2)}]+\gamma_L
$$
其中c用于控制滤波器函数斜面的锐化，$\gamma_L<1,\gamma_H>1$

### 4.8 一些傅里叶变换性质的补充

分配性和比例变换性：

- $\xi[af_1(x,y)+bf_2(x,y)]=a\xi[f_1(x,y)]+b\xi[f_2(x,y)]$

- $f(ax,by)\Leftrightarrow\frac{1}{|ab|}F(u/a,v/b)$

由傅里叶变换的共轭对称性质可以得到结论：频谱是关于原点对称的，经过平移即为中心对称。

可分性（正反变换可以一维一维计算，顺序任意）：
$$
F(u,v)=\frac{1}{MN}\sum^{M-1}_{x=0}e^{-j2\pi ux/M}\sum^{N-1}_{y=0}f(x,y)e^{j2\pi vy/N}=\frac{1}{MN}\sum^{M-1}_{x=0}F(x,v)e^{-j2\pi ux/M}
$$
基于傅里叶变换的共轭性质，利用正变换公式计算反变换：
$$
\frac{1}{M}f^*(x)=\frac{1}{M}\sum^M_{x=0}F^*(u)e^{-j2\pi ux/M}
$$
上式左边取共轭并乘以M就是F(u)反变换后的结果。

在频率域计算卷积的正确步骤：

1. 多两个函数作零延拓至适当的长度
2. 分别作傅里叶变换，长度和延拓后的一致
3. 相乘
4. 计算反变换

### 4.9 相关性理论

相关函数：
$$
g(x,y)=f(x,y)\circ h(x,y)=\sum^{M-1}_{m=0}\sum^{N-1}_{n=0}f^*(m,n)h(x+m,y+n)
$$

$$
f(x,y)\circ h(x,y)\Leftrightarrow F^*(u,v)H(u,v)\\
f^*(x,y)h(x,y)\Leftrightarrow F(u,v)\circ H(u,v)
$$

相关的重要应用是匹配。如果有匹配，会在那里达到最大值。

-------------

## 五、 图像复原

### 5.4 通过频域滤波抑制噪声

#### 5.4.1 二维带阻滤波器

利用带阻滤波器消除周期性噪声

理想带阻滤波器：
$$
H(u,v)=\left\{
\begin{array}{}
1 & D(u,v)<D_0-\frac W2\\
0 & D_0-\frac W2\leq D(u,v)\leq D_0+\frac W2\\
1 & D(u,v)>D_0+\frac W2
\end{array}
\right.
$$
其中$D_0>0$是频谱的中心半径，W是频带的宽度。

二维n阶巴特沃斯带阻滤波器：
$$
H(u,v)=\frac 1{1+[\frac{D(u,v)W}{D^2(u,v)-D_0^2}]^{2n}}
$$
二维高斯带阻滤波器：
$$
H(u,v)=1-\exp(-\frac12[\frac{D(u,v)W}{D^2(u,v)-D_0^2}]^2)
$$

#### 5.4.2 二维带通滤波器

带通滤波器的传递函数$H_{bp}(u,v)$可以根据相应的带阻滤波器传递函数$H_{br}(u,v)$定义：
$$
H_{bp}(u,v)=1-H_{br}(u,v)
$$
利用到带通滤波器可以提取噪声模式。

#### 5.4.3 陷波滤波器

陷波滤波器阻止或通过实现定义的中心频率邻域内的频率。分为陷波带阻滤波器和陷波带通滤波器，每种下面又分为理想、巴特沃斯、高斯等等。

理想陷波带阻滤波器：（半径为$D_0$，中心在$(u_0,v_0)$和$(-u_0,-v_0)$）
$$
H(u,v)=\left\{
\begin{array}{}
0 & D_1(u,v)\leq D_0 &or&D_2(u,v)\leq D_0\\
1 & Others
\end{array}
\right.
$$
其中，
$$
D_1(u,v)=[(u-M/2-u_0)^2+(v-N/2-v_0)^2]^{1/2}\\
D_2(u,v)=[(u-M/2+u_0)^2+(v-N/2+v_0)^2]^{1/2}
$$
巴特沃斯陷波带阻滤波器：
$$
H(u,v)=\frac{1}{1+[\frac{D_0^2}{D_1(u,v)D_2(u,v)}]^n}
$$
高斯陷波带阻滤波器：
$$
H(u,v)=1-\exp(-\frac12[\frac{D_1(u,v)D_2(u,v)}{D_0^2}])
$$
带阻变带通：
$$
H_{hp}(u,v)=1-H_{nr}(u,v)
$$
当$u_0=v_0=0$时，陷波带通滤波器变成低通滤波器

#### 5.4.4 最佳陷波滤波器

当$G(u,v)$存在几种干扰时，采用下面的方法：

1. 提取干扰模式的主频成分：对每个尖峰点设计一个陷波带通滤波器$H(u,v)$，则有：$N(u,v)=H(u,v)G(u,v)$，即$\eta(x,y)=F^{-1}\{H(u,v)G(u,v)\}$
2. 去噪：$\tilde f(x,y)=g(x,y)-w(x,y)\eta(x,y)$，其中$w(x,y)$为调制函数。

一种估计$w(x,y)$的方法：选取$w(x,y)$使得估计值$\tilde f(x,y)$在没一点$(x,y)$指定的邻域上方差最小：
$$
w(x,y)=\frac{\overline{g(x,y)\eta(x,y)}-\overline g(x,y)\overline\eta(x,y)}{\overline{\eta^2}(x,y)-\overline\eta^2(x,y)}
$$

### 5.5 线性移不变的退化

假设系统的模型为$g(x,y)=H(f(x,y))+\eta(x,y)$，如果H是线性移不变的，则存在$h(x,y)$使得：
$$
H(f(x,y))=f(x,y)*h(x,y)=\int^{+\infin}_{-\infin}\int^{+\infin}_{-\infin}f(\alpha,\beta)h(x-\alpha)(y-\beta)d\alpha d\beta
$$
当$f(x,y)=\delta(x,y)$时结果为$h(x,y)$，因此$h(x,y)$称为系统H的冲击响应或点扩散函数PSF。

因此线性移不变的系统的退化模型为：

- 空间域：$g(x,y)=h(x,y)*f(x,y)+\eta(x,y)$
- 频域：$G(u,v)=H(u,v)F(u,v)+N(u,v)$

对这类模型复原的本质是去卷积的过程，该滤波器也称为去卷积滤波器。

### 5.6 估计退化函数

#### 5.6.1 观察估计法

用$g_s(x,y)$定义观察子图像，用$\hat f_s(x,y)$表示构建子图像：
$$
H_s(u,v)=\frac{G_s(u,v)}{\hat F_s(u,v)}
$$
由$H_s{u,v}$推断出$H(u,v)$。

#### 5.6.2 实验估计法

获取与退化图像类似的装置，由成像一个亮点得到退化的冲击响应
$$
A\delta(x,y)\to g(x,y)\Leftrightarrow A\to G(u,v)
$$
故有：$H(u,v)=\frac{G(u,v)}A$。

#### 5.6.3 模型估计法

假设图像$f(x,y)$进行平面运动，$x_0(t)$和$y_0(t)$分别是在x和y方向上的运动速度，图像系统曝光时间为T，则有模糊图像：
$$
g(x,y)=\int_0^Tf[x-x_0(t),y-y_0(t)]dt
$$

$$
G(u,v)=F(u,v)\int^T_0\exp(-j2\pi(ux_0(t)+vy_0(t)))
$$

令$G(u,v)=H(u,v)F(u,v)$，如果图像在 x 和 y 方向上分别以$x_0(t)=at/T$和$y_0(t)=bt/T$做匀速直线运动，则$t=T$时，有：
$$
H(u,v)=\int^T_0\exp(-j2\pi(ua+vb)t/T)dt=\frac{T}{\pi(ua+vb)}\sin[\pi(ua+vb)]\exp(-j\pi(ua+vb))
$$

### 5.7 逆滤波

对于线性移不变模型的退化模型，如果知道：
$$
\hat F(u,v)=\frac{G(u,v)}{H(u,v)}=F(u,v)+\frac{N(u,v)}{H(u,v)}
$$
如果$H(u,v)$值很小则估计会失败。

### 5.8 维纳滤波器

首先建立一套性能指标，然后通过选择合适的冲激响应（或传递函数）来最大化这些性能指标。

假定信号受加性噪声的影响：$x(t)=s(t)+n(t)$，噪声是随机噪声。

1. 最优准则：

$$
MSE=\epsilon\{e^2(t)\}=\int_{-\infin}^\infin e^2(t)dt
$$

其中$e(t)=s(t)-y(t)$

2. 均方误差：

$$
MSE=\epsilon\{s^2(t)\}-2\epsilon\{s(t)y(t)\}+\epsilon\{y^2(t)\}
$$

3. 最优化求解：

$$
H_0(s)=\frac{P_{xs}(s)}{P_x(s)}
$$

4. 维纳滤波设计：

$$
h_0(t)=\int^\infin_{-\infin}H_0(s)e^{j2\tau st}ds
$$

5. 如果信号与噪声不相关则：

$$
\epsilon\{s(t)n(t)\}=\epsilon\{s(t)\}\epsilon\{n(t)\}
$$

于是，
$$
H_0(s)=\left\{\begin{array}{}
\frac{P_s(s)}{P_s(s)+P_n(s)},s\neq 0\\
\frac12,s=0
\end{array}\right.
$$


### 5.9 最小均方误差滤波（维纳去卷积）

一般逆滤波（去卷积）的方法没有考虑噪声。考虑首先去卷积
$$
Y(u,v)=\frac{G(u,v)}{H(u,v)}=F(u,v)+\frac{N(u,v)}{H(u,v)}=F(u,v)+K(u,v)
$$
再对去卷积的结果做维纳滤波
$$
H_0(u,v)=\frac{P_f(u,v)}{P_f(u,v)+P_k(u,v)}=\frac{P_f(u,v)}{P_f(u,v)+|\frac{N(u,v)}{H(u,v)}|^2}
$$
去卷积+维纳滤波：
$$
\hat F(u,v)=[\frac1{H(u,v)}\frac{|H(u,v)|^2}{|H(u,v)|^2+P_\eta(u,v)/P_f(u,v)}]G(u,v)
$$
其中，$P_f(u,v)=|F(u,v)|^2$，为退化函数功率谱；$P_\eta(u,v)=|N(u,v)|^2$，为噪声功率谱。

当噪声为白噪声，
$$
\hat F(u,v)=[\frac1{H(u,v)}\frac{|H(u,v)|^2}{|H(u,v)|^2+K}]G(u,v)
$$

### 5.10 约束最小二乘方滤波器

考虑退化模型$g=Hf+\eta$，平滑约束下等同于找最小的准则函数
$$
C=\sum^{M-1}_{x=0}\sum^{N-1}_{y=0}[\nabla^2\hat f(x,y)]^2
$$
最优解为：
$$
\hat F(u,v)=[\frac{H*(u,v)}{|H(u,v)|^2+r|P(u,v)|^2}]G(u,v)
$$
其中 r 为参数，r=0时退化为逆滤波器。

参数r估计方法：令$||n||^2=||g-H\hat f||^2$，n是r的单调递增函数，估计参数r使得$||n||^2=||\eta||^2\pm\alpha$，其中$\alpha$为给定的精度因数。

参数$||\eta||^2$估计方法：$||\eta||^2=MN[\sigma^2_\eta+m_\eta^2]$

### 5.11 几何均值滤波器

$$
\hat F(u,v)=[\frac{H^*(u,v)}{|H(u,v)|^2}]^\alpha[\frac{H^*(u,v)}{|H(u,v)|^2+b[\frac{P_\eta(u,v)}{P_f(u,v)}]}]^{1-\alpha}
$$

-------

## 六、 彩色图像处理

光特性是颜色科学的核心。

### 6.1 三基色(RGB)原理

自然界常见的各种颜色光，都是由红绿蓝三种颜色光按不同比例相配而成，同样绝大多数颜色也可以分解成红、绿、蓝三种单色光，这就是色度学中最基本的原理：三基色原理。

由于人眼对这三种颜色最敏感，因此红、绿和蓝被选为三基色，组成RGB三维加性空间。

确定颜色的另一种方法是CIE色度图，用坐标表示颜色。其中：

- $x=\frac R{R+G+B}$
- $y=\frac G{R+G+B}$
- $z=1-x-y$

### 6.2 彩色模型

- RGB

- CMY：使用RGB的补色作为基本色。青色Cyan（白减红）、品红Magenta（白减绿）、黄色Yellow（白减蓝）

- CMYK：印刷标准。油墨难以吸收全部颜色，因此加入黑色K

- HIS（HSB）：色调（Hue，单一波长的光的颜色）、饱和度（Saturation，色彩纯度。加入白光越多则饱和度越低）、亮度（Intensity，彩色光对眼镜的刺激强度，与光的能量有关），用于计算机视觉、图像检索等

  - $$
    H=\left\{\begin{array}{}
    \theta & B\leq G\\
    360-\theta & B>G
    \end{array}\right.\\
    \theta=\arccos\frac{\frac 12[(R-G)+(R-B)]}{\sqrt{(R-G)^2+(R-G)(G-B)}}
    $$

  - $S=1-\frac 3{R+G+B}\min(R,G,B)$

  - $I=\frac 13(R+G+B)$

### 6.3 伪彩色处理

根据一定的准则对灰度值赋以彩色的处理。人类可以辨别上千种颜色和强度，只能辨别二十几种灰度。

1. 强度分层：将图像描绘为三维函数$(x,y,f(x,y))$
2. 给不同的强度层$f(x,y)$赋特定的值
3. n对任何输入像素的灰度级执行3个独立变换，n3个变换结果分别送入彩色监视器的红、绿、蓝三个通道

### 6.4、6.5 全彩色图像处理基础、彩色变换

从单通道的灰度拓展到多通道

补色：在彩色环上，与一种色调直接相对立的另一色调称为补色。作用：增强嵌在彩色图像暗区的细节

--------

## 九、 形态学图像处理

### 9.1 二值图像的操作

#### 9.1.1 基本运算

- 反射：$\hat B=\{w|w=-b,b\in B\}$
- 平移：$(A)_z=\{c|c=a+z,a\in A\}$

- 与、或、非、异或
- 非与：A非与B，相当于B - A

#### 9.1.2 膨胀与腐蚀

假设A为原图，B为结构元素，则有：

- 膨胀：$A\oplus B=\{z|(\hat B)_z\cap A\neq\emptyset\}$

膨胀的运算类似于卷积。通过不断的平移反射后的B，如果与A有交集，则将B当前位置所有点加入结果。通过膨胀，可以将图像裂缝桥接起来。

- 腐蚀：$A\Theta B=\{z|(B)_z\subseteq A\}$

通过不断的平移B，如果B被A包含，则将B的中心点加入结果集合。

有：$(A\Theta B)^c=A^c\oplus\hat B$，其中$^c$表示取补集。

#### 9.1.3 开闭操作

开操作一般使对象的轮廓变得光滑，断开狭窄的间断和消除细的突出物。

- 开操作：$A\circ B=(A\Theta B)\oplus B$
  - $A\circ B$是A的子集
  - 如果C是D的子集，则$C\circ B$是$D\circ B$的子集
  - $(A\circ B)\circ B=A\circ B$

闭操作使对象的更为连通，它能消除小的孔洞，并填补轮廓线中的断裂。

- 闭操作：$A\bull B=(A\oplus B)\Theta B$
  - A是$A\bull B$的子集
  - 如果C是D的子集，则$C\bull B$是$D\bull B$的子集
  - $(A\bull B)\bull B=A\bull B$

- 二者关系：$(A\bull B)^c=(A^c\circ \hat B)$

#### 9.1.4 击中

**注意**：匹配操作的实际符号为圈里有星号`*`而不是$\otimes$，下面用$\otimes$表示。

击中或击不中变换是形状检测的基本工具。令每种形状的重心为它的原点，设形状X包含在一个小窗口W中, X的背景定义为W-X. 令B是由X和W-X组成的集合, 使用结构元素B对集合A进行匹配操作的定义为：
$$
A\otimes B=(A\Theta X)\cap[A^c\Theta (W-X)]
$$
令$B=(B_1,B_2)$，则：
$$
A\otimes B=(A\Theta B_1)\cap(A^c\Theta B_2)=(A\Theta B_1)-(A\oplus\hat B_2)
$$
如果A中有和B一样的图像，则结果会在图像中心保留一个点。

### 9.2 基本形态学算法

#### 9.2.1 边界提取

设集合A的边界表示为$\beta(A)=A-(A\Theta B)$，其中B为结构元素。

#### 9.2.2 区域填充

设A为包含子集的集合，区域填充算法是一个迭代算法：

1. 取一个边界内的初始点P，赋值为1.令$X_0=p$
2. $X_k=(X_{k-1}\oplus B)\cap A^C,k=1,2,3...$
3. 当$X_k$收敛，则结果为$X_k\cap A$

#### 9.2.3 提取连通分量

迭代算法：

1. 取子集A中的一个点作为初始点$X_0=p$
2. $X_k=(X_{k-1}\oplus B)\cap A,k=1,2,3...$

3. 当$X_k$收敛，则结果为$X_k$

#### 9.2.4 凸壳

- 凸集：如果连接集合A内任意两点的直线段都在A的内部,就称A是凸集
- 凸壳：任意集合S的**凸壳**H是包含S的最小凸集，集合差H-S称为S的**凸缺**.

求A的凸壳C(A)：

1. 令$B^i,i=1,2,3,4$分别为四个结构元素，每个都是类似俄罗斯方块的一种方块：三个格连成一个直线，中间的一格向旁边延伸出一格。直线的三格值为1，延伸的一格为0。四个结构元素分别对应这个图像的四种旋转角度
2. $X_0^i=A$

3. $X_k^i=(X_{k-1}^i\otimes B^i)\cup A$
4. 四个$X_k^i$都收敛，则结果$C(A)=\cup^4_{i=1}X^i_k$

上述计算的凸壳不能确保凸性所需的最小尺寸，因此要求限制生长以便凸壳不会超过初始集合在水平和垂直方向上的尺寸大小。

#### 9.2.5 细化

**注意**：细化的符号为$\otimes$，而不是圈里带星号。下面用$\star$表示匹配操作。

细化定义为：
$$
A\otimes B=A-(A\star B)=A\cap(A\star B)^c
$$
若$\{B\}=\{B^1,B^2,...,B^n\}$则有：
$$
A\otimes B=A\otimes B^1\otimes B^2...\otimes B^n
$$

#### 9.2.6 粗化

$$
A\odot B=A\cup(A\star B)
$$

若$\{B\}=\{B^1,B^2,...,B^n\}$则有：
$$
A\odot B=A\odot B^1\odot B^2...\odot B^n
$$
粗化和细化的结构元素类似,但1和0要互换。通常用对背景的细化代替粗化,但需要消除断点。

#### 9.2.7 骨架

集合A的骨架S(A)定义为：
$$
S(A)=\{z|A内最大圆盘(D)_z的圆心\}
$$
A可用腐蚀和开操作表达：
$$
S(A)=\cup^K_{k=0}S_k(A)
$$

$$
S_k(A)=(A\Theta kB)-(A\Theta kB)\circ B
$$

其中，$A\Theta kB$表示用B对A进行k次腐蚀。第K次是A被腐蚀为空集合前进行的最后一次迭代，即：
$$
K=\max\{k|(A\Theta kB)\neq\emptyset\}
$$
可以证明：
$$
A=\cup^K_{k=0}(S_k(A)\oplus kB)
$$

#### 9.2.8 裁剪

剪裁通常用于细化和骨架绘制算法的后处理，用于消除“毛刺”，即比较短的像素端点

以裁剪掉小于等于三个像素长度的毛刺为例：

1. 三次细化$X_1=A\otimes B$
2. 提取终点$X_2=\cup^8_{k=1}(X_1\star B^k)$
3. 三次限制膨胀$X_3=(X_2\oplus H)\cap A$，其中H是元素值为1的3*3的结构元素
4. 裁剪结果：$X_4=X_1\cup X_3$

### 9.3 向灰度图的拓展

- 结构元：一幅图像中感兴趣特性所用的小集合或子图像

- 平坦结构元：灰度值完全相同的结构元
- 不平坦结构元：灰度值不完全相同的结构元

#### 9.3.1 膨胀和腐蚀

平坦元 b 腐蚀操作：
$$
[f\Theta b](x,y)=\min_{(s,t)\in b}\{f(x+s,y+t)\}
$$
平坦元 b 膨胀操作：
$$
[f\oplus b](x,y)=\max_{(s,t)\in b}\{f(x-s,y-t)\}
$$
非平坦元$b_N$腐蚀操作：
$$
[f\Theta b_N](x,y)=\min_{(s,t)\in b_N}\{f(x+s,y+t)-b_N(s,t)\}
$$
若所有结构元素为正则图像会变暗。如果在输入图像中亮的细节比结构元素的面积小，则亮度效果将被消弱。

非平坦元$b_N$膨胀操作：
$$
[f\oplus b_N](x,y)=\max_{(s,t)\in b_N}\{f(x-s,y-t)+b_N(s,t)\}
$$
有：
$$
(f\Theta b)^c(s,t)=(f^c\oplus\hat b)(s,t)
$$
其中，$f^c=-f(x,y),\hat b=b)-x,-y$

#### 9.3.2 开闭操作

- 开操作：$f\circ b=(f\Theta b)\oplus b$
- 闭操作：$f\bull b=(f\oplus b)\Theta b$

$$
(f\bull b)^c=(f^c\circ \hat b)
$$

其中，$f^c=-f(x,y)$

开操作经常用于去除小的明亮的细节，闭操作经常用于去除小的黑暗的细节

下面的$e \subseteq r $表示e的域是r的域的子集，且对e的域内的任何(x,y)都有$e(x,y)\leq r(x,y)$。实际上应该用类似回车的符号表示。我打不出来啊==

开操作满足：

- $f\circ b\subseteq f$
- 如果$f_1\subseteq f_2$则$f_1\circ b\subseteq f_2\circ b$

- $(f\circ b)\circ b=f\circ b$

闭操作满足：

- $f\subseteq f\bull b$

- 如果$f_1\subseteq f_2$则$f_1\bull b\subseteq f_2\bull b$

- $(f\bull b)\bull b=f\bull b$

### 9.4 灰度级形态学应用

- 平滑：先开操作后闭操作以去除亮和暗的噪声
- 形态学图像梯度：$g=f\oplus b-f\Theta b$

- 形态学top-hat变换：矫正不均匀的光照影响
  - 白顶帽变换：$T_{hat}=f-f\circ b$
  - 黑底帽变换：$B_{hat}=f\bull b-f$
- 粒度测定：以某一特定的尺度对含有相近尺度颗粒的图像区域进行开操作，然后通过计算输入图像和输出图像之间的差异可以对相近尺寸颗粒的相对数量进行测算
- 形态学纹理分隔：以纹理为基础找到区域的边界

-------------------------

## 十、 图像分割

图像分割一般是基于亮度值的不连续性和相似性来分割。根据不连续性分割图像有奇异点检测、线检测、边缘检测等。依据事先制定的准则将图像分割为相似的区域。

令R为整张图片，则可以将分割看为将R划分为 n 个子区域$R_1,R_2,...,R_n$，满足：

- $\cup_{i=1}^nR_i=R$
- 每个$R_i$是连通的区域
- 每个子区域没有交集
- $P(R_i)=True$，$P(R_i\cup R_j)=False$。

### 10.1 间断检测

寻找间断的最一般方法是对整副图像使用滤波器进行检测，以3*3为例：
$$
R=\sum^9_{i=1}w_iz_i
$$

- 点检测：中间为-8，其他位置为1。如果|R|大于阈值 T 则模板中心点即为所求点。

- 线检测：横或竖或斜角的三个位置为2，其他为-1。四个模板对应四种响应。该点与绝对值最大的那个的方向有关
- 边缘检测：主要使用一阶导数和二阶导数检测图像中的边缘，包括：
  - delta 边缘
  - 阶梯边缘
  - 斜边缘

微小的噪声对导数的影响是巨大的，通常通过阈值确定边缘位置。

#### 10.1.1 一阶边缘检测

梯度向量：
$$
\nabla f=[\begin{array}{}G_x\\G_y\end{array}]=
[\begin{array}{}
\frac{\part f}{\part x}\\\frac{\part f}{\part y}
\end{array}]
$$
灰度最大变化率：
$$
M(x,y)=\sqrt{G_x^2+G_y^2}
$$
梯度方向：
$$
a(x,y)=\arctan\frac{G_y}{G_x}
$$
边缘方向与梯度方向垂直。

#### 10.1.2 二阶边缘检测

拉普拉斯算子：
$$
\nabla^2f(x,y)=\frac{\part^2f(x,y)}{\part x^2}+\frac{\part^2f(x,y)}{\part y^2}
$$
拉普拉斯算子是线性算子：
$$
\frac{\part^2f(x,y)}{\part x^2}=f(x+1,y)+f(x-1,y)-2f(x,y)\\
\frac{\part^2f(x,y)}{\part y^2}=f(x,y+1)+f(x,y-1)-2f(x,y)
$$
由于拉普拉斯算子的应用通常会放大图像的噪声，因此通常先平滑，再应用拉普拉斯算子。

如果$f(x,y)$为原图，有高斯平滑函数$h(x,y)=-\exp(-\frac{x^2+y^2}{2\sigma^2})$，则：
$$
\nabla^2[f(x,y)*h(x,y)]=f(x,y)*\nabla^2h(x,y)
$$

$$
\nabla^2h(x,y)=\frac2{\sigma^2}[1-\frac{x^2+y^2}{2\sigma^2}]\exp(-\frac{x^2+y^2}{2\sigma^2})
$$

称为高斯拉普拉斯算子。其近似模板为墨西哥草帽函数。

#### 10.1.3 Marr-Hildreth边缘检测

1. 对$h(x,y)=\exp(-\frac{x^2+y^2}{2\sigma^2})$采样得到n*n的高斯低通滤波器对图像滤波
2. 将得到的图像做拉普拉斯变换
3. 找到所得图像的零交叉点

#### 10.1.4 高斯差分滤波

使用高斯差分DoG可以近似高斯拉普拉斯LoG：
$$
DoG(x,y)=\frac1{2\pi\sigma_1}\exp(-\frac{x^2+y^2}{2\sigma_1^2})-\frac1{2\pi\sigma_2}\exp(-\frac{x^2+y^2}{2\sigma_2^2})
$$
其中，$\sigma_1>\sigma_2$，可以使用标准方差比例1.6:1建模，则可以获得LoG的工程近似。

#### 10.1.5 Canndy边缘检测

1. 使用高斯滤波器平滑图像
2. 计算梯度幅值图像和角度图像
3. 对梯度幅值图像应用非最大抑制
4. 用双阈值处理和连接分析来检测并连接边缘

非最大抑制方案：

1. 寻找最接近$a(x,y)$的方向d

2. $$
   g_N(x,y)=\left\{\begin{array}{}0,M(x,y)的值至少小于沿d的两个了邻居之一\\M(x,y),otherwise\end{array}\right.
   $$

   其中$g_N(x,y)$表示细化后的变换

用阈值处理减少伪边缘点。过低则伪边缘点较多，过高则会删除真正的边缘点。

双阈值法，高阈值$T_H$和低阈值$T_L$为2：1或3：1。

- $g_{NN}(x,y)=g_N(x,y)\geq T_H$则为强边缘
- $g_{NL}(x,y)=g_N(x,y)\geq T_L$则为弱边缘+强边缘
- $g_{NL}(x,y)=g_{NL}(x,y)-g_{NN}(x,y)$为弱边缘

用弱边缘补齐强边缘，获得完整边缘：

1. 在$g_{NN}(x,y)$中定位下一个未被访问的边缘像素p
2. 在$g_{NL}$中，用8连通性的方法连接到p
3. 如果$g_{NN}(x,y)$中所有非0标记已经访问过则4，否则1
4. 将$g_{NL}(x,y)$中未被标记为有效边缘的像素的所有像素置零
5. 将$g_{NL}(x,y)$中非零像素附加到$g_{NN}(x,y)$

### 10.2 边界连接和边界检测

边界检测=边缘检测和边缘连接。边缘连接：两个端点只有在边缘强度和走向相近的情况下才能连接。

- 局部处理：计算每个像素的梯度幅度和方向，如果相邻像素的幅度和梯度之差的绝对值小于阈值则可以连接起来

- 边界跟踪：假定处理的图像是梯度图像，边界的特征是具有高梯度值，则理论上在梯度图中，最大灰度值在边界上，由此出发，开始由当前边界点和前一个边界点找下一个边界点的过程。噪声存在时，用平滑方法和跟踪虫方法
- 区域处理：如果区域的位置已知，通过多边形拟合算法确定
- Hough变换：已知一组边缘点，找一条直线，使它通过最多的边缘点。在极坐标下，对于边缘点的直线拟合问题，是找一个$(\rho,\theta)$使得边缘点确定的正弦曲线相交最多的点：
  1. 对每个边缘点(x,y)建立方程$\rho=x\cos(\theta)+y\sin(\theta)$
  2. 假定$\rho$和$\theta$有范围，则使用累加器。给定$\theta$，由方程确定$\rho$，通过某个点则累加1
  3. 找到累加器最大的$(\rho,\theta)$

### 10.3 使用阈值（门限）进行图像分割

阈值处理模型：$T=T[x,y,p(x,y),f(x,y)]$，其中$p(x,y)$为该点的局部性质。有：
$$
g(x,y)=\left\{\begin{array}{}
1,f(x,y)>T\\
0,f(x,y)\leq T
\end{array}\right.
$$

- 当T取值于$f(x,y)$时，阈值是全局的
- 当T取值于$f(x,y)$和$p(x,y)$，是局部的

- 当T取值于x和y，是自适应或动态的

亮度成像模型：$f(x,y)=i(x,y)r(x,y)$

背景光照不均匀时阈值处理方法：

- 直接矫正：用恒定灰度的平坦表面成像获得光照模型，通过相反模式来还原
- 顶帽变换获得全局阴影模式
- 可变阈值近似处理非均匀性

阈值确定方法： 

- 试探法：用阈值分割图像，分割的两个区域的平均灰度值作为新的阈值，不断迭代
- 基于Otsu方法的最佳阈值处理：
  1. 使用预设的T将图像灰度分成两个部分
  2. 计算两边的概率$P_1$和$P_2$与均值$m_1$和$m_2$。全局均值为$m_G=P_1m_1+P_2m_2$
  3. 计算全局方差$\sigma_G^2=\sum^{L-1}_{i=0}(i-m_G)^2p_i$、类间方差$\sigma_B^2=P_1(m_1-m_G)^2+P_2(m_2-m_G)^2=P_1P_2(m_1-m_2)^2=\frac{(m_GP_1(k)-m(k))^2}{P_1(k)[1-P_1(k)]}$
  4. 最佳阈值k\*：$\sigma_B^2(k*)=\max_{0\leq k\leq L-1}\sigma_B^2(k)$，如果存在多个k则取品平均。

- 图像平滑改善全局阈值处理

- 边缘改进全局阈值处理：如果尖峰很高，对称且很深的波谷分开，则容易找阈值。梯度算法能够区分边缘区域与平坦区域；拉普拉斯算子可以确定给定的像素在边缘的亮一边还是暗一边

- 多阈值：高维计算
- 可变阈值：图像分块分别求阈值

- 多变量阈值处理：不同的色彩空间进行处理

### 10.4 基于区域的分割

区域生长法：

1. 取一组种子
2. 为区域生长选定规则，相似性准则，利用连通条件
3. 迭代，考虑终止规则

区域分离合并法

### 10.5 基于形态学分水岭分割

将梯度值图像看成一幅地形图，梯度值对应海拔高度，图像中不同梯度值的区域就对应于山峰和山谷间盆地。设想在各个局部极小值点的位置打一个洞，让水以均匀上升速率从洞中涌出，从低到高淹没整个地形。

水坝构造以二值图像为基础，使用形态膨胀的方法分离二元点集构造水坝

--------

## 十一、 表示与描述

基本方法：

- 外部描述：形状
- 内部描述：颜色和纹理

### 11.1 表示方法

- 链码：用于表示由顺次连接的具有指定长度和方向的直线段组成的边界线。4个或8个方向分别用一个数字表示，通过遍历边界得到一串码，因此有4向链码和8向链码
  - 问题：
    - 链码太长
    - 噪声或边界缺陷造成影响
    - 边界链码依赖起点
  - 解决方案：选择更大的间隔对网格对边界进行重新采样
  - 链码的归一化：
    - 起点归一化：在所有可能的链码中选择最小的那一个从而确定起点
    - 旋转归一化：使用链码相邻数字的差值作为新的链码，从而消除顺逆时针的影响（负数取补数，如4向链码的-3变为1）
- 多边形近似
  - 基于收缩的最小周长多边形法：将原边界看作有弹性的线,在像素的约束下将线拉紧
    - MPP算法：边界都看做方形的像素，则边界有一个外框和一个内框。遍历内框，得到所有的凹顶点和凸顶点（记为W），凹边界在当前的像素点内进行对称，变到外边界的点（称为镜像凹顶点，记为B），对W和B进行依次连接。
  - 基于聚合的最小均方误差线段逼近法：相邻顶点直接用直线段连接，不断将相邻的两条线段合并（即忽略中间的顶点，直接将两端的顶点连成直线段），直到继续聚合时新直线的长度会超过阈值
  - 基于分裂的最小均方误差线段逼近法：连接两个最远的边界顶点，看其他顶点到直线的距离，如果超出顶点则加入边界顶点的集合，直到所有的集合外的顶点到边界的最小长度小于阈值
- 标记图方法：使用一维函数进行描述，一般为极坐标方程
  -  标记图不受目标平移的影响，但受目标尺度变换和旋转的影响
  -  尺度变换影响可以通过将最大幅值归一化来解决，旋转的影响的解决方法有：选择离重心最远的点为标记起点或求出边界的主轴,以主轴上离重心最远的点作为标记起点
- 边界线段：将边界分段，从而减小边界的复杂度、求凸壳
- 骨架，采用细化算法实现。求区域骨架的计算实际上采用逐次消去边界点的迭代细化算法实现。
  - 在迭代过程中有三个约束：
    - 不消除线段端点
    - 不中断原来连通的点
    - 不过多腐蚀区域
  - 一种求二值目标区域的骨架的算法（假设目标点标记为1，背景点为0，边界点为本身为1，8邻域至少有一个0的点）：
    1. 对于每个边界点p1，周围8个点分别为p2~p9，顺时针，p2在p1上方。则标记同时满足以下条件的边界点：
       - $2\leq N(p_1)\leq 6$，其中N表示非零邻点的个数
       - $S(p_1)=1$，其中S表示邻域点按顺序$p_2p_3p_4...p_8p_9p_2$从0变为1的次数
       - $p_2\cdot p_4\cdot p_6 = 0$
       - $p_4\cdot p_6\cdot p_8 = 0$
    2. 将所有标记点消去
    3. 同1，但是最后两个条件改为：
       - $p_2\cdot p_4\cdot p_8 = 0$
       - $p_2\cdot p_6\cdot p_8 = 0$
    4. 以上二步操作构成一次迭代。算法反复迭代直至没有点再满足条件，这时剩下的点构成区域的骨架

### 11.2 边界描述子

#### 11.2.1 基本的描述符

- 边界的长度：边界的长度是边界所包含区域轮廓的周长。边界点满足：边界点本身在区域内，但邻域中有像素不属于区域。一条边界上的像素数大致等于其长度。如果边界已经用单位长链码表示，则水平和垂直码的个数加上$\sqrt2$乘以对角码的个数就是边界长度

- 边界的直径：边界上相隔最远的两点的距离：

$$
Diam(B)=\max_{i,j}[D(p_i,p_j)],p_I\in B,p_j\in B
$$

​		其中，$D(\cdot)$可以是任意的距离度量

- 曲率：斜率的变化率，通常采用相邻边界线段的斜率差值。当沿顺时针方向沿着边界运动，当顶点p斜率变化量为非负的时候，称这一点属于凹线段；否则，称p属于凸线段

#### 11.2.2 形状数

形状数是基于链码的一种边界形状描述符，一个边界形状描述是其链码的差分码中值最小的一个序列。形状数长度称为阶数。

#### 11.2.3 傅里叶描绘子

将2D问题转换为1D问题。将边界点的坐标对表示成一个复数：$s(k)=x(k)+jy(k)$，其中$k$为边界点的索引号。对$s(k)$的傅氏变换为：
$$
a(u)=\frac1K\sum_{0}^{K-1}s(k)e^{-j2\pi uk/K}
$$
复系数$a(u)$称为边界的描绘子。傅氏反变换确定边界的重建：
$$
s(k)= \sum^{K-1}_{u=0}a(u)e^{j2\pi uk/K}
$$
通过有限重建构造近似边界：
$$
\hat s(k)= \sum^{P-1}_{u=0}a(u)e^{j2\pi uk/K},K>P
$$

#### 11.2.4 统计矩

刻画边界线段的特征波形。

- 将曲线看做一维函数$g(r)$
- 将g的振幅看做离散的随机变量v，并形成直方图$p(v_i)$，其中$i=0,1,2,...,A-1$
- 定义n阶中心矩：

$$
\mu_n(v)=\sum^{A-1}_{i=0}(v_i-m)^np(v_i)
$$

​	其中，$m=\sum^{A-1}_{i=0}v_ip(v_i)$，m是v的均值。

另一种统计矩：

- 将$g(r)$归一化为单位面积的函数，并作成直方图，即将$g(r_i)$作为产生值$r_i$的概率
- 定义n阶中心矩为：

$$
\mu_n(r)=\sum^{K-1}_{i=0}(r_i-m)^ng(r_i)
$$

​		其中$m=\sum^{K-1}_{i=0}r_ig(r_i)$，即m为r的均值。

### 11.3 区域描绘子

#### 11.3.1 基本的描述符

- 区域的面积：图象中对象区域的面积可以看作区域像素的总和。通常关心一些不变量，如区域致密性：周长的平方除以面积

- 区域的重心，用R代表一个区域，A代表其面积，则重心坐标为：
  $$
  \overline x=\frac1A\sum_{(x,y)\in R}xf(x,y)\\
  \overline y=\frac1A\sum_{(x,y)\in R}yf(x,y)
  $$

- 区域灰度（密度）：常用的区域灰度特征有目标灰度(或颜色分量)的最大值、最小值、中值、平均值、方差以及高阶矩等统计量

#### 11.3.2 拓扑的描述符

定义欧拉数为：
$$
E=C-H
$$
其中，C为区域内连通组元数，H为区域内的孔洞数。

将区域的网络进行目标区域的分类，可以分为顶点数V、边数Q、面数F，其欧拉公式为：
$$
V-Q+F=C-H=E
$$

#### 11.3.3 纹理

纹理就是由纹理基元按某种确定的规律或某种统计规律排列而成，分为确定性纹理和随机性纹理。区域的纹理主要度量区域的平滑度、粗糙度和规律性，描述纹理的方法主要有三种：统计方法、结构方法和频谱方法。

- 统计方法

  - 区域灰度直方图可用n阶矩表示。二阶矩，即方差$\sigma^2(z)=\mu_2(z)$在纹理描述中特别重要，表示图像对比度的度量

  - 光滑度描述子$R=1-\frac1{1+\sigma^2(z)}$,R=0则光滑，1为不光滑

  - 共生矩阵：
    $$
    G(g_1,g_2)=\frac{\sharp\{[(x_1,y_1)(x_2,y_2)]\in S|f(x_1,y_1)=g_1\&f(x_2,y_2)=g_2]\}}{\sharp S}
    $$
    其中$x_2=x_1+dx$，$y_2=y_1+dy$，$\sharp S$为所有坐标对的个数，$g_1$和$g_2$为两个灰度级，构成一个共生矩阵的索引坐标。基于共生矩阵的描述子有：

    - 最大概率：$\max_{i,j}(p_{ij})$
    - 对比度：元素差异的k阶矩：$\sum^K_i\sum^K_j(i-j)^kp_{ij}$
    - 同质性：G对角分布的紧密性：$\sum^K_i\sum^K_jp_{ij}/(1+|i-j|)$
    - 一致性：$\sum^K_i\sum^K_jp^2_{ij}$
    - 熵：$-\sum^K_i\sum^K_jp_{ij}\log_2p_{ij}$
    - 相关性：$\sum^K_i\sum^K_j\frac{(i-m_x)(j-m_y)p_{ij}}{\sigma_x\sigma_y}$

- 结构性方法：处理结构元排列, 诸如基于均匀空间分布的的平行线纹理描述。结构性方法由一组字符串描述符刻画。类似于L-system分形树算法。

- 频谱方法：基于傅里叶频谱特性, 主要用于通过识别频谱中高能量的窄波峰寻找图象中的整体周期。常用的三个特征：

  - 傅里叶频谱中突起的峰值对应纹理模式的主方向

  - 峰值在频域平面的位置对应模式的基本周期

  - 利用滤波器将周期性成分除去，剩下非周期的部分可以通过统计性质描述。通常考虑极坐标：
    $$
    S(r)=\sum^\pi_{\theta=0}S_\theta(r)\\
    S(\theta)=\sum^{R_0}_{r=1}S_r(\theta)
    $$

- 二维函数的矩：定义二维函数的$p+q$阶矩定义为：
  $$
  m_{pq}=\int_{-\infin}^\infin\int_{-\infin}^\infin x^py^qf(x,y)dxdy
  $$
  单值定理说明，如果$f(x,y)$是分段连续的，且仅存在$xy$平面内有限的部分具有非零值，则各阶矩都存在，且矩的序列$m_{pq}$与$f(x,y)$相互唯一确定。

  $p+q$阶中心矩定义为：
  $$
  \mu_{pq}=\int_{-\infin}^\infin\int_{-\infin}^\infin (x-\overline x)^p(y-\overline y)^qf(x,y)dxdy
  $$
  其中：
  $$
  \overline x=\frac{m_{10}}{m_{00}},\overline y=\frac{m_{01}}{m_{00}}
  $$
  如果是数字图像则中心矩为：
  $$
  \mu_{pq}\sum_x\sum_y(x-\overline x)^p(y-\overline y)^qf(x,y)dxdy
  $$

### 11.4 主成量进行描述

运用主分量分析对区域进行描述，计算区域的本征轴，分长轴和短轴。

#### 11.4.1 基于特征向量的变换

通过对一类图像特征分析得出变换核函数。对于N*N的矩阵A，存在N个常数特征值$\lambda_k$组成的特征矩阵，使得：
$$
|A-\lambda_kI|=0
$$
N个满足$AV_k=\lambda_kV_k$的非零解$V_k$称为A的特征向量。如果A是对称的，则所有特征向量构成一个正交基集。

#### 11.4.2 主成成分分析PCA或K-L变换

假设$x$是r维的向量，定义总体的均值向量：
$$
\overline x=E\{x\}
$$
协方差矩阵：
$$
C_x=E\{(x-\overline x)(x-\overline x)^T\}
$$
对于从随机总体中取样的L个向量，X的均值可以通过L个样本向量来估计：
$$
\overline x\approx\frac1L\sum^L_{l=1}x_l
$$
协方差矩阵的估计为：
$$
C_x\approx\frac1L\sum^L_{l=1}x_lx_l^T-\overline x\overline x^T
$$
其中，  $C_x$是半正定的实对称矩阵。

将图像按列堆积成向量，即可进行处理。

对$C_x$进行特征分析，得到一组非负的特征值$\lambda_1,...,\lambda_r$和对应的特征向量$V_1,...,V_r$。令
$$
T=(V_1,V_2,...,V_r)^T
$$
则有：
$$
C_xT^T=[\lambda_i]T^T
$$
作变换：
$$
y=T(x-\overline x)
$$
则有：
$$
C_y=TC_xT^T=
\begin{bmatrix}
\lambda_1 & ... & 0\\
... & ... & ...\\
0 & ... & \lambda_N
\end{bmatrix}
$$
即y各元素互不相关。T为去相关变换。矩阵$\lambda_k$为变换后第k个分量$y_k$的方差。任何向量可以通过y重构：
$$
x=T^Ty+\overline x
$$

#### 11.4.3 降维

将特征根从大到小排列，即$\lambda_1\geq...\geq\lambda_r$，取$1<M<r$使得：
$$
\frac{\sum^M_{i=1}\lambda_i}{\sum^r_{i=1}\lambda_i}>\alpha
$$
令：
$$
T_M=(V_1,V_2,...V_M)^T\\\hat y=T_M(x-\overline x)
$$
则x仍然可以通过$\hat x=T^T_M\hat y+\overline x$进行近似重构。重构的均方误差为：$MSE=\sum^r_{k=M+1}\lambda_k$

使用两个最大特征值对应的特征向量重建的图像会丢失部分细节，可以用于压缩传输。越小的特征值越难以还原出原来的向量。